<!DOCTYPE html>

<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="contents.html">
                contents.js
              </a>
            
              
              <a class="source" href="contentsGroup.html">
                contentsGroup.js
              </a>
            
              
              <a class="source" href="groups.html">
                groups.js
              </a>
            
              
              <a class="source" href="memberGroups.html">
                memberGroups.js
              </a>
            
              
              <a class="source" href="pois.html">
                pois.js
              </a>
            
              
              <a class="source" href="principals.html">
                principals.js
              </a>
            
              
              <a class="source" href="proposals.html">
                proposals.js
              </a>
            
              
              <a class="source" href="searchFilters.html">
                searchFilters.js
              </a>
            
              
              <a class="source" href="subGroups.html">
                subGroups.js
              </a>
            
              
              <a class="source" href="tags.html">
                tags.js
              </a>
            
              
              <a class="source" href="style-helpers.html">
                style-helpers.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="admins.html">
                admins.js
              </a>
            
              
              <a class="source" href="content.html">
                content.js
              </a>
            
              
              <a class="source" href="discovery.html">
                discovery.js
              </a>
            
              
              <a class="source" href="group.html">
                group.js
              </a>
            
              
              <a class="source" href="partners.html">
                partners.js
              </a>
            
              
              <a class="source" href="poi.html">
                poi.js
              </a>
            
              
              <a class="source" href="principal.html">
                principal.js
              </a>
            
              
              <a class="source" href="proposal.html">
                proposal.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="searchFilter.html">
                searchFilter.js
              </a>
            
              
              <a class="source" href="searchGroup.html">
                searchGroup.js
              </a>
            
              
              <a class="source" href="tag.html">
                tag.js
              </a>
            
              
              <a class="source" href="tagSet.html">
                tagSet.js
              </a>
            
              
              <a class="source" href="teacherSearch.html">
                teacherSearch.js
              </a>
            
              
              <a class="source" href="teachers.html">
                teachers.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="adminsAsDiscovery.html">
                adminsAsDiscovery.js
              </a>
            
              
              <a class="source" href="discoveryAsContent.html">
                discoveryAsContent.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchGroup.html">
                oaeAsMainSearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResult.html">
                oaeAsMainSearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResults.html">
                oaeAsMainSearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchGroup.html">
                oaeAsSecondarySearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResult.html">
                oaeAsSecondarySearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResults.html">
                oaeAsSecondarySearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightItem.html">
                oaeAsSpotlightItem.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightList.html">
                oaeAsSpotlightList.js
              </a>
            
              
              <a class="source" href="partnersAsDiscovery.html">
                partnersAsDiscovery.js
              </a>
            
              
              <a class="source" href="poiAsMarker.html">
                poiAsMarker.js
              </a>
            
              
              <a class="source" href="poisAsMap.html">
                poisAsMap.js
              </a>
            
              
              <a class="source" href="searchAsForm.html">
                searchAsForm.js
              </a>
            
              
              <a class="source" href="searchFilterAsItem.html">
                searchFilterAsItem.js
              </a>
            
              
              <a class="source" href="searchFiltersAsList.html">
                searchFiltersAsList.js
              </a>
            
              
              <a class="source" href="tagAsCheckbox.html">
                tagAsCheckbox.js
              </a>
            
              
              <a class="source" href="tagSetAsCheckboxGroup.html">
                tagSetAsCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagSetAsInlineCheckboxGroup.html">
                tagSetAsInlineCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagsAsCheckboxes.html">
                tagsAsCheckboxes.js
              </a>
            
              
              <a class="source" href="teacherSearchAsPage.html">
                teacherSearchAsPage.js
              </a>
            
              
              <a class="source" href="teachersAsDiscovery.html">
                teachersAsDiscovery.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global window, Stem, _, Backbone, $*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The parent component for the entire application
is the <code>app</code> router. (It’s the only router used.)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Stem.Routers = Stem.Routers || {};

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-pi">    'use strict'</span>;

    Stem.Routers.App = Backbone.Router.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The STEM application is about the simplest
possible single page app. Each “page” is
bootstrapped as a <code>&lt;section&gt;</code> in the
<code>index.html</code> file, so the only routes we
need are routes corresponding to the
various sections. We also define a
parameterized search page a default
page (which is the same as the primary
landing page).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        routes: {
            <span class="hljs-string">''</span>:         <span class="hljs-string">'landing'</span>,
            <span class="hljs-string">'teachers'</span>: <span class="hljs-string">'teachers'</span>,
            <span class="hljs-string">'admins'</span>:   <span class="hljs-string">'admins'</span>,
            <span class="hljs-string">'partners'</span>: <span class="hljs-string">'partners'</span>,
            <span class="hljs-string">'search(/)(:query)(/:facet)'</span>: <span class="hljs-string">'search'</span>,
            <span class="hljs-string">'*default'</span>: <span class="hljs-string">'landing'</span>,
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>We use a convenience function to
switch to a specific section. Its
first parameter is the <code>id</code> of the
destination section. The second
(optional) parameter is a theme
to apply to the header.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        loadPage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id, theme)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>To “switch” pages set the <code>data-hide</code>
attribute on the sections as
appropriate. All sections other than
the selected one have <code>data-hide=&quot;1&quot;</code>,
and the selected section has
<code>data-hide=&quot;0&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            $(<span class="hljs-string">'section'</span>).not(<span class="hljs-string">'#'</span> + id).attr(<span class="hljs-string">'data-hide'</span>,<span class="hljs-string">'1'</span>);
            $(<span class="hljs-string">'section#'</span> + id).attr(<span class="hljs-string">'data-hide'</span>,<span class="hljs-string">'0'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>We also want to update the navigation
bar with a theme appropriate to the
page. To do that, we set the appropriate
<code>data-</code> attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (theme) {
                $(<span class="hljs-string">'header'</span>).attr(<span class="hljs-string">'data-theme'</span>, theme);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Close the navigation menu (in case it was
used to trigger the page change). Since
our event handler only detects changes
initiated by the user, we also have to
manually clear the <code>data-nav-expanded</code>
attribute on the <code>&lt;main&gt;</code> elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            $(<span class="hljs-string">'#nav-toggle'</span>).prop(<span class="hljs-string">'checked'</span>, <span class="hljs-number">0</span>);
            $(<span class="hljs-string">'main'</span>).attr(<span class="hljs-string">'data-nav-expanded'</span>, <span class="hljs-string">'0'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>If Google Analytics is available, track
the page load.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ga !== <span class="hljs-string">'undefined'</span>) {
                ga(<span class="hljs-string">'send'</span>, <span class="hljs-string">'pageview'</span>, id);
                ga(<span class="hljs-string">'set'</span>, <span class="hljs-string">'page'</span>, id);
            }

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Convenience function to set the discovery
section on the landing page by setting the
appropriate radio buttons in the nav.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        setDiscovery: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(discoveryId, dontScroll)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Find the index of the appropriate
article so we can set the attribute
for CSS.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            <span class="hljs-keyword">var</span> discoveryIdx = <span class="hljs-number">0</span>;
            $(<span class="hljs-string">'article.discovery'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(idx)</span></span>{
                <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'id'</span>) === discoveryId + <span class="hljs-string">'_js'</span>) {
                    discoveryIdx = idx+<span class="hljs-number">1</span>;
                }
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Set the appropriate button and clear all
the others.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            $(<span class="hljs-string">'#discovery-nav input[type="radio"]'</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(idx)</span> </span>{
                $(<span class="hljs-keyword">this</span>).prop(<span class="hljs-string">'checked'</span>, (discoveryIdx === (idx+<span class="hljs-number">1</span>)));
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Since changing the property doesn’t trigger
a <code>change</code> event (!), we have to set the <code>data-</code>
attribute explicitly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            $(<span class="hljs-string">'#discovery-nav'</span>).attr(<span class="hljs-string">'data-discovery-nav'</span>, discoveryIdx);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If the view is a mobile view in which
the different discovery sections are
stacked and the discovery navigation is
hidden, scroll to the selected section.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#discovery-nav'</span>).css(<span class="hljs-string">'display'</span>) === <span class="hljs-string">'none'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Calculating the scroll position is a
little complicated because we have to
account for the fact that the menu
may be expanded when this function
is called, but the desired position
is based on a collapsed menu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                
                <span class="hljs-keyword">var</span> pos = $(<span class="hljs-string">'#'</span> + discoveryId + <span class="hljs-string">'_js'</span>).offset().top -
                    <span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">'main'</span>).css(<span class="hljs-string">'padding-top'</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If the optional <code>dontScroll</code> parameter
is true, we don’t want to scroll to
the discovery position. Instead, scroll
to the top.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                $(<span class="hljs-string">'html,body'</span>).scrollTop(dontScroll ? <span class="hljs-number">0</span> : pos);

            }

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The default landing page is the
teachers page, but we don’t want
to scroll to the section.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        landing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.loadPage(<span class="hljs-string">'landing'</span>,<span class="hljs-string">'theme-1-dark'</span>);
            <span class="hljs-keyword">this</span>.setDiscovery(<span class="hljs-string">'teachers'</span>, <span class="hljs-literal">true</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The individual route handlers follow. All they
do is set the discovery navigation to the
appropriate section, load the landing page,
and show the appropriate discovery content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        teachers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.loadPage(<span class="hljs-string">'landing'</span>,<span class="hljs-string">'theme-1-dark'</span>);
            <span class="hljs-keyword">this</span>.setDiscovery(<span class="hljs-string">'teachers'</span>);
        },

        admins: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.loadPage(<span class="hljs-string">'landing'</span>,<span class="hljs-string">'theme-1-dark'</span>);
            <span class="hljs-keyword">this</span>.setDiscovery(<span class="hljs-string">'admins'</span>);
        },

        partners: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">this</span>.loadPage(<span class="hljs-string">'landing'</span>,<span class="hljs-string">'theme-1-dark'</span>);
            <span class="hljs-keyword">this</span>.setDiscovery(<span class="hljs-string">'partners'</span>);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>The search page is a little more involved
because we need to set up the appropriate
facet for the search. If there is no
explicit facet in the URL, we default to
the content facet. We also set the free-
text query contents based on the URL, if
any content is available. After setting
up the search facet and query, we load
the search page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        search: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(query, facet)</span> </span>{
            query = query || <span class="hljs-string">''</span>;
            facet = facet || <span class="hljs-string">'content'</span>;
            <span class="hljs-keyword">this</span>.teacherSearch.set(<span class="hljs-string">'facet'</span>,
                <span class="hljs-built_in">decodeURIComponent</span>(facet));
            <span class="hljs-keyword">this</span>.searchQuery.set(<span class="hljs-string">'query'</span>,
                <span class="hljs-built_in">decodeURIComponent</span>(query));
            <span class="hljs-keyword">this</span>.loadPage(<span class="hljs-string">'teachers-search'</span>,<span class="hljs-string">'theme-1'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Set the scroll position to the top
of the new “page” since we’re switching
to the search results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            $(<span class="hljs-string">'html,body'</span>).scrollTop(<span class="hljs-number">0</span>);

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>User clicked the main navigation bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        navClicked: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Normally we don’t have to do anything
here. If, however, the user clicks on
the menu item that matches what’s
already in the hash, the browser ignores
it. We don’t want to ignore it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.hash === $(ev.target).attr(<span class="hljs-string">'href'</span>)) {
                <span class="hljs-keyword">this</span>[<span class="hljs-built_in">window</span>.location.hash.slice(<span class="hljs-number">1</span>)].call(<span class="hljs-keyword">this</span>);
            }
            
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>The <code>initialize</code> function performs most of
the work in bootstrapping the app.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>The initial static page has several
elements with <code>id</code> attributes matched
to URL fragments. We define the 
attributes that way so that the site
works for users without JavaScript
(albeit with reduced functionality).
Since we’re here executing this code,
though, JavaScript is, by definition,
available. In this case, we don’t
want the browser scrolling to these
page elements. Doing so would
interfere with the hashtag routing
of Backbone. To eliminate the 
the conflict, we replace the original
<code>id</code> attribute values with new values
that don’t correspond to hashtags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            _([<span class="hljs-string">'teachers'</span>,<span class="hljs-string">'admins'</span>,<span class="hljs-string">'partners'</span>]).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
                $(<span class="hljs-string">'#'</span> + id).attr(<span class="hljs-string">'id'</span>, id + <span class="hljs-string">'_js'</span>);
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Create the models that back each of the
app’s “pages” and other content blocks.
Currently there are two primary models
representing the two major sections of
content on the site.</p>
<ul>
<li><a href="discovery.html">discovery</a> handles
the “Discovery blocks” on the main
landing page.</li>
<li><a href="teacherSearch.html">teacherSearch</a>
manages the search results page.
(Currently the only search results
the site provides are focused on
teachers.)</li>
</ul>
<p>Those two models both include general
seach functionality, and we want the
search query values to be synchronized.
(In other words, if a user starts
typing a search query in the discovery
block, we want that partial search
query to show up in the teacher search
results if the user navigates to the
search resuls page. To have both models
share search queries, we create a common
<a href="search.html">search</a> model that both
of the main models can share.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.searchQuery = <span class="hljs-keyword">new</span> Stem.Models.Search({
                label: <span class="hljs-string">'Search resources'</span>,
                placeholder: <span class="hljs-string">'Search the Incubator'</span>
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Now we can create the principle models
that include this query.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.discovery = <span class="hljs-keyword">new</span> Stem.Models.Discovery({
                searchQuery: <span class="hljs-keyword">this</span>.searchQuery
            });
            <span class="hljs-keyword">this</span>.teacherSearch = <span class="hljs-keyword">new</span> Stem.Models.TeacherSearch({
                searchQuery: <span class="hljs-keyword">this</span>.searchQuery
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Create and render the views for each
page or content block. It’s okay to
render them now because they’ll remain
hidden until the user navigates to
them. Start with the
<a href="discoveryAsContent.html">discoveryContent</a>
view for the “Discovery blocks”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.discoveryContent = <span class="hljs-keyword">new</span> Stem.Views.DiscoveryAsContent({
                el: $(<span class="hljs-string">'#landing'</span>),
                model: <span class="hljs-keyword">this</span>.discovery
            }).render();</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Now we create the second of our two
main views. This view controls the
<a href="teacherSearchAsPage.html">teacherSearchPage</a>
part of the site.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.teacherSearchPage = <span class="hljs-keyword">new</span> Stem.Views.TeacherSearchAsPage({
                el: $(<span class="hljs-string">'#teachers-search'</span>),
                model: <span class="hljs-keyword">this</span>.teacherSearch
            }).render();</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Handle high level events from the views
we’ve created.</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If the discovery content view detects
that the user submits a search form,
we want to navigate to the search
results “page.”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.discoveryContent.on(<span class="hljs-string">'search:submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Retrieve the submitted query.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">this</span>.searchQuery.get(<span class="hljs-string">'query'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Although in general we don’t trigger
a full route when we update the navigation,
in this case we really do want the app
to behave exactly as if the user had
navigated to the web site. Setting <code>trigger: true</code>
is simpler than replicating the code in
multiple places.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.navigate(<span class="hljs-string">'search/'</span> + <span class="hljs-built_in">encodeURIComponent</span>(query) + <span class="hljs-string">'/content'</span>,
                    {trigger: <span class="hljs-literal">true</span>});

            }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>The discoveryContent view triggers
<code>navigate</code> events when the user navigates
to a new discovery region. We don’t have
to do very much when that event occurs
since the CSS takes care of exposing the
appropriate content. We do want to make
sure that the navigation is added to
the browser history, though, so that the
back/forward buttons work as expected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.discoveryContent, <span class="hljs-string">'navigate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hash)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>To make the URL hash consistent with
non-JavaScript users (e.g. if a JS-user
shares a link with a non-JS-user), strip
of the special <code>_js</code> bit that we added
to the <code>id</code> attribute during initialization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">this</span>.navigate(hash.slice(<span class="hljs-number">0</span>,-<span class="hljs-number">3</span>));

            });</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Just as with the discoveryContent view,
the teacherSearch model triggers a
<code>navigate</code> event when the user performs
a navigation action. As before, the view
itself handles most of the work, but we
do want to add the new navigation URL
to the browser history for back/forward
button operation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.teacherSearch, <span class="hljs-string">'navigate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hash)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Add the new hash to the browser history, but
only if we’re on the search “page”. If we’re
on the landing page, then the router itself
will take care of the history.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.hash.indexOf(<span class="hljs-string">'#search'</span>) === <span class="hljs-number">0</span>) {

                    <span class="hljs-keyword">this</span>.navigate(<span class="hljs-string">'search/'</span> + hash);

                }

            });</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>We also have to account for an edge case in 
mobile views. If the user starts at a particular
section (e.g. <code>#partners</code>) and then scrolls back
to the top, the URL hash will still be <code>#partners</code>.
In that case, the browser won’t recognize subsequent
clicks on the same element in the navigation menu.
We have to catch those manually.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            $(<span class="hljs-string">'.site-hdr__navbar__list a'</span>).on(<span class="hljs-string">'click'</span>, 
                $.proxy(<span class="hljs-keyword">this</span>.navClicked, <span class="hljs-keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Everything’s ready, so enable history management.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            Backbone.history.start();

        }
    });

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
