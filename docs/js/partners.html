<!DOCTYPE html>

<html>
<head>
  <title>partners.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="contents.html">
                contents.js
              </a>
            
              
              <a class="source" href="contentsGroup.html">
                contentsGroup.js
              </a>
            
              
              <a class="source" href="groups.html">
                groups.js
              </a>
            
              
              <a class="source" href="memberGroups.html">
                memberGroups.js
              </a>
            
              
              <a class="source" href="pois.html">
                pois.js
              </a>
            
              
              <a class="source" href="principals.html">
                principals.js
              </a>
            
              
              <a class="source" href="proposals.html">
                proposals.js
              </a>
            
              
              <a class="source" href="searchFilters.html">
                searchFilters.js
              </a>
            
              
              <a class="source" href="subGroups.html">
                subGroups.js
              </a>
            
              
              <a class="source" href="tags.html">
                tags.js
              </a>
            
              
              <a class="source" href="style-helpers.html">
                style-helpers.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="admins.html">
                admins.js
              </a>
            
              
              <a class="source" href="content.html">
                content.js
              </a>
            
              
              <a class="source" href="discovery.html">
                discovery.js
              </a>
            
              
              <a class="source" href="group.html">
                group.js
              </a>
            
              
              <a class="source" href="partners.html">
                partners.js
              </a>
            
              
              <a class="source" href="poi.html">
                poi.js
              </a>
            
              
              <a class="source" href="principal.html">
                principal.js
              </a>
            
              
              <a class="source" href="proposal.html">
                proposal.js
              </a>
            
              
              <a class="source" href="search.html">
                search.js
              </a>
            
              
              <a class="source" href="searchFilter.html">
                searchFilter.js
              </a>
            
              
              <a class="source" href="searchGroup.html">
                searchGroup.js
              </a>
            
              
              <a class="source" href="tag.html">
                tag.js
              </a>
            
              
              <a class="source" href="tagSet.html">
                tagSet.js
              </a>
            
              
              <a class="source" href="teacherSearch.html">
                teacherSearch.js
              </a>
            
              
              <a class="source" href="teachers.html">
                teachers.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="adminsAsDiscovery.html">
                adminsAsDiscovery.js
              </a>
            
              
              <a class="source" href="discoveryAsContent.html">
                discoveryAsContent.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchGroup.html">
                oaeAsMainSearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResult.html">
                oaeAsMainSearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsMainSearchResults.html">
                oaeAsMainSearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchGroup.html">
                oaeAsSecondarySearchGroup.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResult.html">
                oaeAsSecondarySearchResult.js
              </a>
            
              
              <a class="source" href="oaeAsSecondarySearchResults.html">
                oaeAsSecondarySearchResults.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightItem.html">
                oaeAsSpotlightItem.js
              </a>
            
              
              <a class="source" href="oaeAsSpotlightList.html">
                oaeAsSpotlightList.js
              </a>
            
              
              <a class="source" href="partnersAsDiscovery.html">
                partnersAsDiscovery.js
              </a>
            
              
              <a class="source" href="poiAsMarker.html">
                poiAsMarker.js
              </a>
            
              
              <a class="source" href="poisAsMap.html">
                poisAsMap.js
              </a>
            
              
              <a class="source" href="searchAsForm.html">
                searchAsForm.js
              </a>
            
              
              <a class="source" href="searchFilterAsItem.html">
                searchFilterAsItem.js
              </a>
            
              
              <a class="source" href="searchFiltersAsList.html">
                searchFiltersAsList.js
              </a>
            
              
              <a class="source" href="tagAsCheckbox.html">
                tagAsCheckbox.js
              </a>
            
              
              <a class="source" href="tagSetAsCheckboxGroup.html">
                tagSetAsCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagSetAsInlineCheckboxGroup.html">
                tagSetAsInlineCheckboxGroup.js
              </a>
            
              
              <a class="source" href="tagsAsCheckboxes.html">
                tagsAsCheckboxes.js
              </a>
            
              
              <a class="source" href="teacherSearchAsPage.html">
                teacherSearchAsPage.js
              </a>
            
              
              <a class="source" href="teachersAsDiscovery.html">
                teachersAsDiscovery.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>partners.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global Stem, _, Backbone*/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The partners model encapsulates information
about partnerships between schools and
businessses.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Stem.Models = Stem.Models || {};

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
<span class="hljs-pi">    'use strict'</span>;

    Stem.Models.Partners = Backbone.Model.extend({

        setupOrganizations: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Organizations are schools or businesses
looking for partnerships. We create a
collection to store them as points of
interest. Weâ€™ll build that collection
from two general subGroup collections from
the OAE.</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>For all of the collections below, we
check to see if one already exists (e.g.
was provided when this model was
created). Although mainly for ease of
unit testing, this may come in handy
in the future, if, e.g. different parts
of the site want to re-use the same
collection(s).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'organizationPois'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'organizationPois'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.Pois()
                );
            }

            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'organizations'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'organizations'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.SubGroups([],{
                       limit: Stem.config.map.poiLimit,
                       parentId: Stem.config.oae.groups.organizations
                    })
                );
            }

            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'businesses'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'businesses'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.SubGroups([], {
                       limit: Stem.config.map.poiLimit,
                        parentId: Stem.config.oae.groups.businesses
                    })
                );
            }

            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'schools'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'schools'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.SubGroups([],{
                       limit: Stem.config.map.poiLimit,
                       parentId: Stem.config.oae.groups.schools
                    })
                );
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>To keep things readable, use local variables
as a convenient reference to these attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">var</span> organizations = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'organizations'</span>);
            <span class="hljs-keyword">var</span> businesses = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'businesses'</span>);
            <span class="hljs-keyword">var</span> schools = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'schools'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Before we fetch the data from the OAE,
set up handlers to deal with additions to
each collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            organizations.on(<span class="hljs-string">'add'</span>, <span class="hljs-keyword">this</span>.organizationAdded, <span class="hljs-keyword">this</span>);
            businesses.on(<span class="hljs-string">'add'</span>, <span class="hljs-keyword">this</span>.businessAdded, <span class="hljs-keyword">this</span>);
            schools.on(<span class="hljs-string">'add'</span>, <span class="hljs-keyword">this</span>.schoolAdded, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If the collections were supplied on model
creation, they already have members, so
simply add them. If the collections are
empty, then we fetch them from the OAE.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (organizations.length &gt; <span class="hljs-number">0</span>) {
                organizations.each(_(<span class="hljs-keyword">this</span>.organizationAdded).bind(<span class="hljs-keyword">this</span>));
            } <span class="hljs-keyword">else</span> {
                organizations.fetch({validate: <span class="hljs-literal">true</span>});
            }

            <span class="hljs-keyword">if</span> (businesses.length &gt; <span class="hljs-number">0</span>) {
                businesses.each(_(<span class="hljs-keyword">this</span>.businessAdded).bind(<span class="hljs-keyword">this</span>));
            } <span class="hljs-keyword">else</span> {
                businesses.fetch({validate: <span class="hljs-literal">true</span>});
            }

            <span class="hljs-keyword">if</span> (schools.length &gt; <span class="hljs-number">0</span>) {
                schools.each(_(<span class="hljs-keyword">this</span>.schoolAdded).bind(<span class="hljs-keyword">this</span>));
            } <span class="hljs-keyword">else</span> {
                schools.fetch({validate: <span class="hljs-literal">true</span>});
            }

        },

        setupProposals: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Create a new collection that tracks
proposals as points of interest (e.g.
on a map). We allow this collection to
be provided during model creation for
ease of testing and future flexibility/</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'proposalPois'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'proposalPois'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.Pois()
                );
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>A separate collection holds the proposals
that have points of interest.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'proposals'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'proposals'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.Proposals([],{
                        maxSize: <span class="hljs-number">50</span>
                    })
                );
            }

            <span class="hljs-keyword">var</span> proposals = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'proposals'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>For each DonorsChoose proposal, add a corresponding
model to our points of interest collection. Since
these proposals will be incrementally added to the
collection once we trigger the fetch, we hook the
<code>add</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            proposals.on(<span class="hljs-string">'add'</span>, <span class="hljs-keyword">this</span>.proposalAdded, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Finally, handle the case in which proposals
were provided during model creation. In
that case, we donâ€™t need to fetch them
from the service but can simply add them
now.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (proposals.length &gt; <span class="hljs-number">0</span>) {
                proposals.each(_(<span class="hljs-keyword">this</span>.proposalAdded).bind(<span class="hljs-keyword">this</span>));
            } <span class="hljs-keyword">else</span> {
                proposals.fetch();
            }

        },

        setupPartnerships: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Spotlights are featured case studies
of successful partnerships that we
access as sub-groups on the OAE.
All we need to do for set up is
define the collection and initiate
a fetch. As with other collections,
we permit the collection to be
specified when the model is
created.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'partnerships'</span>)) {
                <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'partnerships'</span>,
                    <span class="hljs-keyword">new</span> Stem.Collections.SubGroups([], {
                        limit: <span class="hljs-number">10</span>,
                        parentId: Stem.config.oae.groups.partnerships
                    })
                );
            }

            <span class="hljs-keyword">var</span> partnerships = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'partnerships'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If the collection is empty (i.e.
not supplied in the modelâ€™s
creation), fetch it from the OAE.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (partnerships.length === <span class="hljs-number">0</span>) {
                partnerships.fetch({validate: <span class="hljs-literal">true</span>});
            }

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Get the latitude and longitude
for an OAE group,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        getLatLong: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(group, className)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Look for an explicit latitude/longitude
or a street address in the groupâ€™s
description.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">if</span> (group.get(<span class="hljs-string">'description'</span>)) {
                
                <span class="hljs-keyword">var</span> descLines = _(group.get(<span class="hljs-string">'description'</span>).split(<span class="hljs-string">'\n'</span>))
                    .map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line)</span> </span>{
                        <span class="hljs-keyword">return</span> line.trim();
                    });

                <span class="hljs-keyword">var</span> geoLines = _(descLines).filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line)</span> </span>{
                        <span class="hljs-keyword">return</span> (line.indexOf(<span class="hljs-string">'latlong:'</span>) === <span class="hljs-number">0</span>) ||
                               (line.indexOf(<span class="hljs-string">'Latlong:'</span>) === <span class="hljs-number">0</span>) ||
                               (line.indexOf(<span class="hljs-string">'LatLong:'</span>) === <span class="hljs-number">0</span>) ||
                               (line.indexOf(<span class="hljs-string">'LATLONG:'</span>) === <span class="hljs-number">0</span>);
                    });

                <span class="hljs-keyword">var</span> addrLines = _(descLines).filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(line)</span> </span>{
                        <span class="hljs-keyword">return</span> (line.indexOf(<span class="hljs-string">'address:'</span>) === <span class="hljs-number">0</span>) ||
                               (line.indexOf(<span class="hljs-string">'Address:'</span>) === <span class="hljs-number">0</span>) ||
                               (line.indexOf(<span class="hljs-string">'ADDRESS:'</span>) === <span class="hljs-number">0</span>);
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>If we found lat/long in the
description, weâ€™re in business.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                <span class="hljs-keyword">if</span> (geoLines.length) {

                    <span class="hljs-keyword">var</span> latLong = _(geoLines[<span class="hljs-number">0</span>].substr(<span class="hljs-number">8</span>).trim().split(<span class="hljs-string">','</span>))
                        .map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(coords)</span> </span>{
                            <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(coords);
                        });
                    
                    <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'organizationPois'</span>).add(
                        <span class="hljs-keyword">new</span> Stem.Models.Poi({
                            className: className,
                            imageUrl:  Stem.Utils.oaeUrl(group.get(<span class="hljs-string">'thumbnailUrl'</span>)),
                            latitude:  latLong[<span class="hljs-number">0</span>],
                            link:      Stem.Utils.oaeUrl(group.get(<span class="hljs-string">'profilePath'</span>)),
                            longitude: latLong[<span class="hljs-number">1</span>],
                            title:     group.get(<span class="hljs-string">'displayName'</span>)
                        })
                    );</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>No explicit lat/long; how about a
street address?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (addrLines.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Use a network service to retrieve
geographic coordinates from a
street address.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    Stem.Utils.getLocationFromStreet(
                        addrLines[<span class="hljs-number">0</span>].substr(<span class="hljs-number">8</span>).trim(),
                        _.bind(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(latLong)</span> </span>{

                            <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'organizationPois'</span>).add(
                                <span class="hljs-keyword">new</span> Stem.Models.Poi({
                                    className: className,
                                    imageUrl:  Stem.Utils.oaeUrl(group.get(<span class="hljs-string">'thumbnailUrl'</span>)),
                                    latitude:  latLong[<span class="hljs-number">0</span>],
                                    link:      Stem.Utils.oaeUrl(group.get(<span class="hljs-string">'profilePath'</span>)),
                                    longitude: latLong[<span class="hljs-number">1</span>],
                                    title:     group.get(<span class="hljs-string">'displayName'</span>)
                                })
                            );

                        }, <span class="hljs-keyword">this</span>)

                    );

                }

            }

        },

        organizationAdded: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(business)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Try to extract geolocation from the
group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.getLatLong(business, <span class="hljs-string">'theme-3-dark poi-organization'</span>);

        },

        businessAdded: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(business)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Try to extract geolocation from the
group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.getLatLong(business, <span class="hljs-string">'theme-3 poi-business'</span>);

        },

        schoolAdded: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(school)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Try to extract geolocation from the
group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.getLatLong(school, <span class="hljs-string">'theme-3-light poi-school'</span>);

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Function called when a new DonorsChoose proposal
has been fetched from DonorsChoose and added to
our internal collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        proposalAdded: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(proposal)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Extract the relevant information from the
DonorsChoose response for our own POI model
and add it to our internal collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'proposalPois'</span>).add(
                <span class="hljs-keyword">new</span> Stem.Models.Poi({
                    className: <span class="hljs-string">'theme-0-black poi-proposal'</span>,
                    imageUrl:  proposal.get(<span class="hljs-string">'thumbImageURL'</span>),
                    latitude:  proposal.get(<span class="hljs-string">'latitude'</span>),
                    link:      proposal.get(<span class="hljs-string">'proposalURL'</span>),
                    longitude: proposal.get(<span class="hljs-string">'longitude'</span>),
                    title:     proposal.get(<span class="hljs-string">'title'</span>)
                })
            );

        },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Model iniitalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Set up the individual parts of the model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">this</span>.setupOrganizations();
            <span class="hljs-keyword">this</span>.setupProposals();
            <span class="hljs-keyword">this</span>.setupPartnerships();

        }

    });

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
